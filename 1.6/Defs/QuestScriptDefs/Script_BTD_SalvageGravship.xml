<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <QuestScriptDef>
    <defName>BTD_SalvageGravship</defName>
    <rootSelectionWeight>0</rootSelectionWeight>
    <autoAccept>false</autoAccept>
    <successHistoryEvent>BTD_SalvageGravshipCompleted</successHistoryEvent>
    <questNameRules>
      <rulesStrings>
        <li>questName->Salvage Gravship</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->An abandoned gravship has been located nearby. The ship appears intact but requires initialization. Travel to the site and initialize the grav engine when ready - but be warned, the process will attract hostile forces.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_GetMap" />
        <li Class="RWM_BTD_Remix_GravshipBlueprints.QuestNode_BTD_GetSalvageSiteTile">
          <storeAs>siteTile</storeAs>
        </li>
        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>BTD_SalvageGravship</tag></li>
          </sitePartsTags>
        </li>
        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>
        <li Class="QuestNode_GetSiteThreatPoints">
          <storeAs>sitePoints</storeAs>
          <sitePartsParams>$sitePartsParams</sitePartsParams>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        <li Class="RWM_BTD_Remix_GravshipBlueprints.QuestNode_BTD_StoreGravshipDesign">
          <site>$site</site>
        </li>
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>
        <li Class="QuestNode_Letter">
          <label>Salvage gravship located</label>
          <text>Long-range sensors have detected an abandoned but intact gravship. This is an exceptional opportunity! Travel to the site and initialize the grav engine when you're ready. The initialization process will take time and attract hostile forces, so prepare accordingly.</text>
          <lookTargets>$site</lookTargets>
        </li>
		<li Class="QuestNode_Signal">
          <inSignal>site.Hacked</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Grav engine initialized</label>
                <text>The grav engine initialization is complete! The gravship is now fully operational. Deconstruction and uninstall restrictions have been lifted - you can now modify the ship as you see fit.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Success</outcome>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest failed: Salvage Gravship</label>
                <text>You were unable to salvage the gravship.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
</Defs>