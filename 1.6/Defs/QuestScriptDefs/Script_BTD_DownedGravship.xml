<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <QuestScriptDef>
    <defName>BTD_DownedGravship</defName>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <autoAccept>true</autoAccept>
    <successHistoryEvent>BTD_DownedGravshipCompleted</successHistoryEvent>
    <questNameRules>
      <rulesStrings>
        <li>questName->Downed Gravship</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->A damaged gravship has crash-landed nearby. Hostile forces are defending the wreck. Hack the damaged grav engine and loot what you can before the site expires in 30 days.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_GetMap" />
        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>false</preferCloserTiles>
          <canSelectSpace>true</canSelectSpace>
        </li>
        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>BTD_DownedGravship</tag></li>
          </sitePartsTags>
        </li>
        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>
        <li Class="QuestNode_GetSiteThreatPoints">
          <storeAs>sitePoints</storeAs>
          <sitePartsParams>$sitePartsParams</sitePartsParams>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        <li Class="RWM_BTD_Remix_GravshipBlueprints.QuestNode_BTD_StoreGravshipDesign">
          <site>$site</site>
        </li>
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>
        <li Class="QuestNode_Signal">
          <inSignal>BTD_GravEngineHacked.$site</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Grav engine hacked</label>
                <text>Your colonists have successfully extracted valuable gravcore components from the damaged engine.</text>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>1800000</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Downed gravship site expired</label>
                <text>The downed gravship site has expired and is no longer accessible.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_End">
            <outcome>Success</outcome>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
</Defs>